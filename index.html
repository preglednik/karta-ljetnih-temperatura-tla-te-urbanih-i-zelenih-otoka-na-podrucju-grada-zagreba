<!doctype html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="google-site-verification" 
      content="google23a9c3762fc1cd27">
      <meta name="keywords" content="karta ljetnih temperatura tla na području Grada Zagreba, temperatura tla, temperatura zraka, ljetna temperatura, temperature u Zagrebu, Zagreb">
      <meta name="description" content="Karta ljetnih temperatura tla na području Grada Zagreba">
      <link rel="stylesheet" href="css/leaflet.css">
      <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
      <link rel="stylesheet" href="css/qgis2web.css">
      <link rel="stylesheet" href="css/fontawesome-all.min.css">
      <link rel="stylesheet" href="css/leaflet.photon.css">
      <link rel="stylesheet" href="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
      <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>

      <style>
        html, body, #map {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        }

        .temperaturna-legenda {
        position: absolute;
        left: 10px;
        top: 160px;
        background: white;
        border: 1px solid #999;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.25);
        padding: 10px;
        z-index: 2000;
        font-family: 'PT Sans Narrow', sans-serif;
        font-size: 12.25px;
        line-height: 1;
        display: none;
        max-height: 90%;
        overflow-y: auto;
        }

        .temperaturna-legenda table {
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%;
        }

        .temperaturna-legenda tr {
        line-height: 0;
        height: 0;
        }

        .temperaturna-legenda td {
        padding: 0;
        margin: 0;
        vertical-align: middle;
        }

        .temperaturna-legenda img {
        display: block;
        width: 20px;
        height: 10px;
        margin: 0;
        padding: 0;
        }

        .naslov-temperaturne-legende {
        font-family: 'PT Sans', sans-serif;
        font-weight: 700;
        text-align: center;
        margin-bottom: 4px;
        font-size: 12.5px;
        }

        .temp {
        position: absolute;
        background-color: #fff !important;
        border-radius: 4px !important;
        top: 110px;
        left: 10px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
        cursor: pointer;
        width: 36px;
        height: 36px;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #000;
        z-index: 1000;
        }

        #tempraspon {
        position: absolute;
        bottom: 10px;
        display: none;
        font-family: 'PT Sans', sans-serif;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(255,255,255,0.9);
        padding: 8px 10px;
        border-radius: 8px;
        text-align: center;
        }
        
        #animacijaslojeva {
        width: 280px;
        }
        
        #nadnevci {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        font-family: 'PT Sans', sans-serif;
        margin-top: 2px;
        color: #333;
        }

        #autogumb {
        margin-top: 6px;
        cursor: pointer;
        background: #999999;
        color: white;
        border: none;
        border-radius: 20px;
        padding: 8px 16px;
        font-family: 'PT Sans', sans-serif;
        font-size: 14px;
        transition: background 0.3s;
        }

        #autogumb:hover {
        background: #777777;
        }

        #mjeseci {
        font-size: 14px;
        color: #333;
        margin-top: 6px;
        }

        .raspon {
        background-color: #fff !important;
        border: none;
        border-radius: 4px !important;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
        cursor: pointer;
        width: 36px;
        height: 36px;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #333;
        position: absolute;
        top: 60px;
        left: 10px;
        z-index: 1000;
        }

        .pomak-okvir {
        display: none;
        position: absolute;
        top: 56px;
        left: 60px;
        align-items: center;
        gap: 20px;
        width: 360px;
        z-index: 1000;
        background: #ffffff;
        border-radius: 20px;
        padding: 8px 16px;
        font-family: 'PT Sans', sans-serif;
        color: black;
        }

        .vrijednost {
        width: 40px;
        text-align: center;
        font-family: 'PT Sans', sans-serif;
        font-size: 16px;
        }

        .pomak-box {
        flex: 1;
        position: relative;
        height: 30px;
        }

        .traka {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 6px;
        width: 100%;
        background: #ddd;
        border-radius: 3px;
        }

        .range {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        height: 6px;
        border-radius: 3px;
        }

        .klizac {
        width: 14px;
        height: 14px;
        background: #000;
        border-radius: 50%;
        position: absolute;
        font-family: 'PT Sans', sans-serif;
        top: 50%;
        transform: translate(-50%, -50%);
        cursor: pointer;
        }

        .leaflet-control-layers-toggle {
        width: 35px !important;
        height: 36px !important;
        background-size: 26px 26px !important;
        background-position: center center;
        background-repeat: no-repeat;
        font-family: 'PT Sans', sans-serif !important;
        background-color: #fff;
        border: none !important;
        border-radius: 4px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
        cursor: pointer;
        }

        .leaflet-top.leaflet-right .leaflet-control-layers {
        margin-top: 55px;
        }

        .leaflet-control-scale {
        left: 5px !important;
        font-family: 'PT Sans', sans-serif !important;
        bottom: 15px !important;
        }

        #koordinatni-okvir {
        position: fixed;
        bottom: 10px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.95);
        color: black;
        padding: 8px 12px;
        border-radius: 10px;
        font-family: 'PT Sans', sans-serif;
        font-size: 12px;
        display: none;
        align-items: center;
        gap: 10px;
        box-shadow: 0 0 8px rgba(0,0,0,0.4);
        z-index: 1000;
        width: max-content;
        white-space: nowrap;
        }

        #izbor-projekcije {
        font-family: 'PT Sans', sans-serif;
        font-size: 12px;
        padding: 5px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        outline: none;
        cursor: pointer;
        background-color: white;
        box-shadow: 0 0 4px rgba(0,0,0,0.1);
        width: max-content;
        }

        #koordinate {
        font-family: 'PT Sans', monospace;
        white-space: nowrap;
        }

        .leaflet-control-attribution {
        left: 10px !important;
        bottom: 10px !important;
        right: auto !important;
        text-align: left !important;
        display: flex !important;
        align-items: center;
        gap: 5px;
        padding: 3px 8px !important;
        background: rgba(255,255,255,0.8) !important;
        box-shadow: 0 0 8px rgba(0,0,0,0.3) !important;
        border-radius: 4px !important;
        font-size: 14px !important;
        }

        .leaflet-control-attribution img {
        vertical-align: middle;
        }

        .leaflet-control.abstract {
        position: absolute !important;
        top: 0px !important;
        right: 3.5px !important;
        z-index: 2000 !important;
        width: 37px !important;
        height: 36px !important;
        border: none !important;
        background-color: #f8f9fa !important;
        background-image: url('https://raw.githubusercontent.com/preglednik/tis-ikona/main/Karta%20ljetnih%20temperatura%20tla%20u%20Gradu%20Zagrebu.ico') !important;
        background-size: 36px 36px !important;
        background-position: center center !important;
        background-repeat: no-repeat !important;
        border-radius: 4px !important;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
        font-size: 18px;
        text-align: center;
        line-height: 36px;
        color: transparent !important;
        cursor: pointer;
        user-select: none;
        }

        .leaflet-control.abstractUncollapsed {
        background-color: #f8f9fa !important;
        font-family: 'PT Sans', sans-serif;
        font-size: 9pt;
        max-width: 400px;
        max-height: 70vh;
        overflow-y: auto;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 0 8px rgba(0,0,0,0.4);
        color: black;
        }

        .leaflet-control-layers {
          box-shadow: none !important;
        }

      </style>

      <title>Karta ljetnih temperatura tla na području Grada Zagreba</title>
      <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/preglednik/tis-ikona/main/Karta%20ljetnih%20temperatura%20tla%20u%20Gradu%20Zagrebu.ico">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

  </head>
  <body>
    <div id="map"></div>

    <div class="raspon" id="rasponIcon" title="Odaberi raspon temperature">
    <i class="fas fa-arrows-alt-h"></i></div>

    <div class="temp" id="tempIcon" title="Prikaži temperaturnu ljestvicu">
    <i class="fas fa-thermometer-half"></i>
    </div>

    <div class="pomak-okvir" id="pomakokvir">
    <div class="vrijednost" id="valMinSide">0°C</div>
    <div class="pomak-box" id="pomak">
    <div class="traka"></div>
    <div class="range" id="range"></div>
    <div class="klizac" id="klizacMin"></div>
    <div class="klizac" id="klizacMax"></div></div>
    <div class="vrijednost" id="valMaxSide">50°C</div></div>

    <div id="tempraspon">
    <input type="range" id="animacijaslojeva" min="0" max="9" value="9">
    <div id="nadnevci">
    <span>2021.</span>
    <span>2025.</span></div>
    <button id="autogumb">Pokreni automatsku izmjenu</button>
    <div id="mjeseci"></div></div>

    <div id="temperaturna-legenda" class="temperaturna-legenda">
    <div class="naslov-temperaturne-legende">Temperaturna ljestvica [°C]</div>
      <table>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_010.png" /></td><td>0°C - 1°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_121.png" /></td><td>1°C - 2°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_232.png" /></td><td>2°C - 3°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_343.png" /></td><td>3°C - 4°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_454.png" /></td><td>4°C - 5°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_565.png" /></td><td>5°C - 6°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_676.png" /></td><td>6°C - 7°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_787.png" /></td><td>7°C - 8°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_898.png" /></td><td>8°C - 9°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_9109.png" /></td><td>9°C - 10°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_101110.png" /></td><td>10°C - 11°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_111211.png" /></td><td>11°C - 12°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_121312.png" /></td><td>12°C - 13°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_131413.png" /></td><td>13°C - 14°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_141514.png" /></td><td>14°C - 15°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_151615.png" /></td><td>15°C - 16°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_161716.png" /></td><td>16°C - 17°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_171817.png" /></td><td>17°C - 18°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_181918.png" /></td><td>18°C - 19°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_192019.png" /></td><td>19°C - 20°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_202120.png" /></td><td>20°C - 21°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_212221.png" /></td><td>21°C - 22°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_222322.png" /></td><td>22°C - 23°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_232423.png" /></td><td>23°C - 24°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_242524.png" /></td><td>24°C - 25°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_252625.png" /></td><td>25°C - 26°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_262726.png" /></td><td>26°C - 27°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_272827.png" /></td><td>27°C - 28°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_282928.png" /></td><td>28°C - 29°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_293029.png" /></td><td>29°C - 30°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_303130.png" /></td><td>30°C - 31°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_313231.png" /></td><td>31°C - 32°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_323332.png" /></td><td>32°C - 33°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_333433.png" /></td><td>33°C - 34°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_343534.png" /></td><td>34°C - 35°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_353635.png" /></td><td>35°C - 36°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_363736.png" /></td><td>36°C - 37°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_373837.png" /></td><td>37°C - 38°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_383938.png" /></td><td>38°C - 39°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_394039.png" /></td><td>39°C - 40°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_404140.png" /></td><td>40°C - 41°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_414241.png" /></td><td>41°C - 42°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_424342.png" /></td><td>42°C - 43°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_434443.png" /></td><td>43°C - 44°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_444544.png" /></td><td>44°C - 45°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_454645.png" /></td><td>45°C - 46°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_464746.png" /></td><td>46°C - 47°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_474847.png" /></td><td>47°C - 48°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_484948.png" /></td><td>48°C - 49°C</td></tr>
        <tr><td><img src="legend/Prosjenaljetnatemperaturatla_9_495049.png" /></td><td>49°C - 50°C</td></tr>
      </table></div>

    <div id="koordinatni-okvir">
    <select id="izbor-projekcije">
    <option value="wgs84">WGS84</option>
    <option value="htrs96">HTRS96/TM</option>
    </select>
    <div id="koordinate">φ: ---, λ: ---</div></div>

    <script src="js/leaflet.js"></script>
    <script src="js/L.Control.Layers.Tree.min.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="https://unpkg.com/leaflet.locatecontrol/dist/L.Control.Locate.min.js"></script>
    <script src="https://unpkg.com/leaflet-compass/dist/leaflet-compass.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="data/15kolovoza2025_0.js"></script>
    <script src="data/14srpnja2025_1.js"></script>
    <script src="data/12kolovoza2024_2.js"></script>
    <script src="data/11srpnja2024_3.js"></script>
    <script src="data/26kolovoza2023_4.js"></script>
    <script src="data/16srpnja2023_5.js"></script>
    <script src="data/22srpnja2022_6.js"></script>
    <script src="data/27lipnja2022_7.js"></script>
    <script src="data/24lipnja2021_8.js"></script>
    <script src="data/Prosjenaljetnatemperaturatla_9.js"></script>
    
    <script>

    var map = L.map('map', {
    zoomControl: false,
    maxZoom: 19,
    minZoom: 10,
    attributionControl: false
    }); 

    var attribution = L.control.attribution({
    prefix: false,
    position: 'bottomleft'
    }).addTo(map);
    attribution.addAttribution(
    '<img src="https://leafletjs.com/docs/images/logo.png" ' +
    'style="height:22px; cursor:pointer;" ' +
    'alt="Leaflet logo" ' +
    'title="Leaflet" ' +
    'onclick="window.open(\'https://leafletjs.com\', \'_blank\')">'
    );
    
    map.createPane('tilesAbove');
    map.getPane('tilesAbove').style.zIndex = 650; 
 
    var ESRI = L.tileLayer('https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', 
    {
    maxZoom: 19,
    pane: 'tilesAbove',
    opacity: 0.3
    });
    var Kartografska_podloga = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    pane: 'tilesAbove',
    opacity: 0.30
    });
    Kartografska_podloga.addTo(map);

    var hash = new L.Hash(map);
    var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

    L.control.locate({
      strings: {
      title: "Prikaži moju lokaciju",
      popup: "Nalazite se unutar {distance} m od ovog mjesta.",
      outsideMapBoundsMsg: "Nalazite se izvan granica karte.",
      }
      }).addTo(map);

    L.control.scale(
      {position: 'bottomleft', 
      imperial: false, 
      metric: true
      })
      .addTo(map);

    var abstract = new L.Control({'position':'topright'});
      abstract.onAdd = function (map) {
      this._div = L.DomUtil.create('div',
      'leaflet-control abstract');
      this._div.id = 'abstract'
      this._div.setAttribute("onmouseenter", "abstract.show()");
      this._div.setAttribute("onmouseleave", "abstract.hide()");
      this.hide();
      return this._div;
      };
      abstract.hide = function () {
      this._div.classList.remove("abstractUncollapsed");
      this._div.classList.add("abstract");
      this._div.innerHTML = 'i'
      }
      abstract.show = function () {
      this._div.classList.remove("abstract");
      this._div.classList.add("abstractUncollapsed");
      this._div.innerHTML = '<strong style="font-size: 18pt; font-family: \'PT Serif\', sans-serif; text-align: center; display: block;">Karta ljetnih temperatura tla <br> na području Grada Zagreba</strong><br>'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10.5pt; text-align: justify; display: block;">'
      + 'Ova web karta izrađena je u sklopu kolegija \'\'Kartografija i nove tehnologije\'\' na Geodetskom fakultetu Sveučilišta u Zagrebu, pod vodstvom doc. dr. sc. Ane Kuveždić Divjak.</span>'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10.5pt; text-align: justify; display: block;">'
      + 'Karta prikazuje površinsku temperaturu tla na području Grada Zagreba na ljetne dane: 24. lipnja 2021., 27. lipnja i 22. srpnja 2022., 16. srpnja i 26. kolovoza 2023., 11. srpnja i 12. kolovoza 2024. te 14. srpnja i 15. kolovoza 2025. Karta omogućuje uvid u rasprostiranje područja s visokim temperaturama (korištenjem filtera) ili animirani vremenski prikaz promjena temperatura.'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10.5pt; text-align: justify; display: block;">'
      + 'Kartografski prikaz nastao je korištenjem devet snimki satelitske misije Landsat 8, 30-metarske prostorne rezolucije, a njihovim usrednjavanjem dobivena je prosječna ljetna temperatura tla u Gradu Zagrebu od 2021. do 2025. godine.</span>'
      + '</span><br>'
      + '<strong style="font-size: 10pt; font-family: \'PT Sans\', sans-serif;">Kartografska projekcija:</strong><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">Web Mercatorova projekcija (EPSG: 3857)</span><br><br />'
      + '<strong style="font-size: 10pt; font-family: \'PT Sans\', sans-serif;">Mjesto i vrijeme izrade:</strong><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">Zagreb, prosinac 2025.</span><br><br />'
      + '<strong style="font-size: 10pt; font-family: \'PT Sans\', sans-serif;">Izvornici:</strong><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">- Nacionalna infrastruktura prostornih podataka</span><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">- ESRI World Imagery</span><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">- OpenStreetMap</span><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">- Earth Explorer</span><br><br />'
      + '<strong style="font-size: 10pt; font-family: \'PT Sans\', sans-serif;">Autor:</strong><br />'
      + '<span style="font-family: \'PT Sans\', sans-serif; font-size: 10pt;">Josip Alpeza, univ. bacc. ing. geod. et geoinf.</span><br />';
      };
      abstract.addTo(map);

    const tempIcon = document.getElementById("tempIcon");
    tempIcon.addEventListener("click", () => {
    const legend = document.getElementById("temperaturna-legenda");
    const icon = tempIcon.querySelector("i");
    if (legend.style.display === 'none' || legend.style.display === '') {
      legend.style.display = 'block';
      icon.style.color = 'red';
    } else {
      legend.style.display = 'none';
      icon.style.color = '#000';
    }
    });

    var bounds_group = new L.featureGroup([]);
      function setBounds() {
      if (bounds_group.getLayers().length) {
      map.fitBounds(bounds_group.getBounds());
      }
      }
    
    function skocni_okvir(feature, layer) {
      var popupContent = '<strong>Temperatura tla [°C]</strong><br />' + 
      (feature.properties['Temperatur'] !== null ? feature.properties['Temperatur'] : '');
      layer.bindPopup(popupContent, { maxHeight: 400 });
      }

    function style_temperatura(feature) {
      const colors = [
        'rgba(44,123,182,1.0)','rgba(54,131,186,1.0)','rgba(65,138,190,1.0)','rgba(75,146,194,1.0)','rgba(85,154,199,1.0)','rgba(96,161,203,1.0)','rgba(106,169,207,1.0)',
        'rgba(117,177,211,1.0)','rgba(127,184,215,1.0)','rgba(137,192,219,1.0)','rgba(148,200,224,1.0)','rgba(158,207,228,1.0)','rgba(168,215,232,1.0)','rgba(177,220,230,1.0)',
        'rgba(186,224,226,1.0)','rgba(195,228,221,1.0)','rgba(203,232,217,1.0)','rgba(212,235,213,1.0)','rgba(220,239,208,1.0)','rgba(229,243,204,1.0)','rgba(237,247,200,1.0)',
        'rgba(246,251,196,1.0)','rgba(255,255,191,1.0)','rgba(255,247,182,1.0)','rgba(255,239,172,1.0)','rgba(254,230,163,1.0)','rgba(254,222,153,1.0)','rgba(254,213,143,1.0)',
        'rgba(254,205,134,1.0)','rgba(253,197,124,1.0)','rgba(253,188,114,1.0)','rgba(253,180,105,1.0)','rgba(252,170,95,1.0)','rgba(248,155,88,1.0)','rgba(244,140,82,1.0)',
        'rgba(241,125,75,1.0)','rgba(237,111,68,1.0)','rgba(233,96,61,1.0)','rgba(229,81,54,1.0)','rgba(225,66,47,1.0)','rgba(221,51,40,1.0)','rgba(217,36,33,1.0)','rgba(212,26,29,1.0)',
        'rgba(202,24,27,1.0)','rgba(193,23,26,1.0)','rgba(183,22,25,1.0)','rgba(174,21,24,1.0)','rgba(164,20,22,1.0)','rgba(155,19,21,1.0)','rgba(140,16,19,1.0)'
      ];

    let temp = Math.floor(feature.properties['Temperatur']);
      return {
      opacity: 1,
      color: 'rgba(35,35,35,0.0)',
      dashArray: '',
      lineCap: 'butt',
      lineJoin: 'miter',
      weight: 1.0,
      fill: true,
      fillOpacity: 1,
      fillColor: colors[temp],
      interactive: true,
      };
      }

    map.createPane('pane_15kolovoza2025_0');
    map.getPane('pane_15kolovoza2025_0').style.zIndex = 400;
    map.getPane('pane_15kolovoza2025_0').style['mix-blend-mode'] = 'normal';
    var layer_15kolovoza2025_0 = new L.geoJson(json_15kolovoza2025_0, {
      attribution: '',
      interactive: true,
      dataVar: 'json_15kolovoza2025_0',
      layerName: 'layer_15kolovoza2025_0',
      pane: 'pane_15kolovoza2025_0',
      onEachFeature: skocni_okvir,
      style: style_temperatura, 
      smoothFactor: 0
      });
    layer_15kolovoza2025_0._allFeatures = json_15kolovoza2025_0.features.slice(0);
    bounds_group.addLayer(layer_15kolovoza2025_0);

    map.createPane('pane_14srpnja2025_1');
    map.getPane('pane_14srpnja2025_1').style.zIndex = 401;
    map.getPane('pane_14srpnja2025_1').style['mix-blend-mode'] = 'normal';
    var layer_14srpnja2025_1 = new L.geoJson(json_14srpnja2025_1, {
      attribution: '',
      interactive: true,
      dataVar: 'json_14srpnja2025_1',
      layerName: 'layer_14srpnja2025_1',
      pane: 'pane_14srpnja2025_1',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_14srpnja2025_1._allFeatures = json_14srpnja2025_1.features.slice(0);
    bounds_group.addLayer(layer_14srpnja2025_1);

    map.createPane('pane_12kolovoza2024_2');
    map.getPane('pane_12kolovoza2024_2').style.zIndex = 402;
    map.getPane('pane_12kolovoza2024_2').style['mix-blend-mode'] = 'normal';
    var layer_12kolovoza2024_2 = new L.geoJson(json_12kolovoza2024_2, {
      attribution: '',
      interactive: true,
      dataVar: 'json_12kolovoza2024_2',
      layerName: 'layer_12kolovoza2024_2',
      pane: 'pane_12kolovoza2024_2',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_12kolovoza2024_2._allFeatures = json_12kolovoza2024_2.features.slice(0);
    bounds_group.addLayer(layer_12kolovoza2024_2);

    map.createPane('pane_11srpnja2024_3');
    map.getPane('pane_11srpnja2024_3').style.zIndex = 403;
    map.getPane('pane_11srpnja2024_3').style['mix-blend-mode'] = 'normal';
    var layer_11srpnja2024_3 = new L.geoJson(json_11srpnja2024_3, {
      attribution: '',
      interactive: true,
      dataVar: 'json_11srpnja2024_3',
      layerName: 'layer_11srpnja2024_3',
      pane: 'pane_11srpnja2024_3',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_11srpnja2024_3._allFeatures = json_11srpnja2024_3.features.slice(0);
    bounds_group.addLayer(layer_11srpnja2024_3);
    
    map.createPane('pane_26kolovoza2023_4');
    map.getPane('pane_26kolovoza2023_4').style.zIndex = 404;
    map.getPane('pane_26kolovoza2023_4').style['mix-blend-mode'] = 'normal';
    var layer_26kolovoza2023_4 = new L.geoJson(json_26kolovoza2023_4, {
      attribution: '',
      interactive: true,
      dataVar: 'json_26kolovoza2023_4',
      layerName: 'layer_26kolovoza2023_4',
      pane: 'pane_26kolovoza2023_4',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_26kolovoza2023_4._allFeatures = json_26kolovoza2023_4.features.slice(0);
    bounds_group.addLayer(layer_26kolovoza2023_4);

    map.createPane('pane_16srpnja2023_5');
    map.getPane('pane_16srpnja2023_5').style.zIndex = 405;
    map.getPane('pane_16srpnja2023_5').style['mix-blend-mode'] = 'normal';
    var layer_16srpnja2023_5 = new L.geoJson(json_16srpnja2023_5, {
      attribution: '',
      interactive: true,
      dataVar: 'json_16srpnja2023_5',
      layerName: 'layer_16srpnja2023_5',
      pane: 'pane_16srpnja2023_5',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_16srpnja2023_5._allFeatures = json_16srpnja2023_5.features.slice(0);
    bounds_group.addLayer(layer_16srpnja2023_5);

    map.createPane('pane_22srpnja2022_6');
    map.getPane('pane_22srpnja2022_6').style.zIndex = 406;
    map.getPane('pane_22srpnja2022_6').style['mix-blend-mode'] = 'normal';
    var layer_22srpnja2022_6 = new L.geoJson(json_22srpnja2022_6, {
      attribution: '',
      interactive: true,
      dataVar: 'json_22srpnja2022_6',
      layerName: 'layer_22srpnja2022_6',
      pane: 'pane_22srpnja2022_6',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_22srpnja2022_6._allFeatures = json_22srpnja2022_6.features.slice(0);
    bounds_group.addLayer(layer_22srpnja2022_6);

    map.createPane('pane_27lipnja2022_7');
    map.getPane('pane_27lipnja2022_7').style.zIndex = 407;
    map.getPane('pane_27lipnja2022_7').style['mix-blend-mode'] = 'normal';
    var layer_27lipnja2022_7 = new L.geoJson(json_27lipnja2022_7, {
      attribution: '',
      interactive: true,
      dataVar: 'json_27lipnja2022_7',
      layerName: 'layer_27lipnja2022_7',
      pane: 'pane_27lipnja2022_7',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_27lipnja2022_7._allFeatures = json_27lipnja2022_7.features.slice(0);
    bounds_group.addLayer(layer_27lipnja2022_7);
    
    map.createPane('pane_24lipnja2021_8');
    map.getPane('pane_24lipnja2021_8').style.zIndex = 408;
    map.getPane('pane_24lipnja2021_8').style['mix-blend-mode'] = 'normal';
    var layer_24lipnja2021_8 = new L.geoJson(json_24lipnja2021_8, {
      attribution: '',
      interactive: true,
      dataVar: 'json_24lipnja2021_8',
      layerName: 'layer_24lipnja2021_8',
      pane: 'pane_24lipnja2021_8',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_24lipnja2021_8._allFeatures = json_24lipnja2021_8.features.slice(0);
    bounds_group.addLayer(layer_24lipnja2021_8);

    map.createPane('pane_Prosjenaljetnatemperaturatla_9');
    map.getPane('pane_Prosjenaljetnatemperaturatla_9').style.zIndex = 409;
    map.getPane('pane_Prosjenaljetnatemperaturatla_9').style['mix-blend-mode'] = 'normal';
    var layer_Prosjenaljetnatemperaturatla_9 = new L.geoJson(json_Prosjenaljetnatemperaturatla_9, {
      attribution: '',
      interactive: true,
      dataVar: 'json_Prosjenaljetnatemperaturatla_9',
      layerName: 'layer_Prosjenaljetnatemperaturatla_9',
      pane: 'pane_Prosjenaljetnatemperaturatla_9',
      onEachFeature: skocni_okvir,
      style: style_temperatura,
      smoothFactor: 0
      });
    layer_Prosjenaljetnatemperaturatla_9._allFeatures = json_Prosjenaljetnatemperaturatla_9.features.slice(0);
    bounds_group.addLayer(layer_Prosjenaljetnatemperaturatla_9);
    map.addLayer(layer_Prosjenaljetnatemperaturatla_9);

    var overlaysTree = [
      {label: 'Prosječna ljetna temperatura tla<br />', layer: layer_Prosjenaljetnatemperaturatla_9},
      {label: '24. lipnja 2021.<br />', layer: layer_24lipnja2021_8},
      {label: '27. lipnja 2022.<br />', layer: layer_27lipnja2022_7},
      {label: '22. srpnja 2022.<br />', layer: layer_22srpnja2022_6},
      {label: '16. srpnja 2023.<br />', layer: layer_16srpnja2023_5},
      {label: '26. kolovoza 2023.<br />', layer: layer_26kolovoza2023_4},
      {label: '11. srpnja 2024.<br />', layer: layer_11srpnja2024_3},
      {label: '12. kolovoza 2024.<br />', layer: layer_12kolovoza2024_2},
      {label: '14. srpnja 2025.<br />', layer: layer_14srpnja2025_1},
      {label: '15. kolovoza 2025.<br />', layer: layer_15kolovoza2025_0},
      {label: 'Kartografska podloga<br>&nbsp;&nbsp;&nbsp;&nbsp;<input id="osm-opacity" type="range" min="0" max="1" step="0.05" value="0.3" style="width:100px;">', layer: Kartografska_podloga},
      {label: 'Satelitska snimka<br>&nbsp;&nbsp;&nbsp;&nbsp;<input id="esri-opacity" type="range" min="0" max="1" step="0.05" value="0.3" style="width:100px;">', layer: ESRI},
      ];

    var lay = L.control.layers.tree(null, overlaysTree, { collapsed: true });
    lay.addTo(map);

    function bindOpacitySliders() {
      const osm = document.getElementById('osm-opacity');
      const esri = document.getElementById('esri-opacity');

      if (osm && !osm._bound) {
      osm.addEventListener('input', function (e) {
      e.stopPropagation();
      Kartografska_podloga.setOpacity(parseFloat(this.value));
      });
      L.DomEvent.disableClickPropagation(osm);
      osm._bound = true;
      }

      if (esri && !esri._bound) {
      esri.addEventListener('input', function (e) {
      e.stopPropagation();
      ESRI.setOpacity(parseFloat(this.value));
      });
      L.DomEvent.disableClickPropagation(esri);
      esri._bound = true;
    }
    }

    bindOpacitySliders();
    setInterval(bindOpacitySliders, 500);

    var layers = [
      layer_24lipnja2021_8,
      layer_27lipnja2022_7,
      layer_22srpnja2022_6,
      layer_16srpnja2023_5,
      layer_26kolovoza2023_4,
      layer_11srpnja2024_3,
      layer_12kolovoza2024_2,
      layer_14srpnja2025_1,
      layer_15kolovoza2025_0,
      layer_Prosjenaljetnatemperaturatla_9
      ];

    var currentLayer = layer_Prosjenaljetnatemperaturatla_9;
    var slider = document.getElementById("animacijaslojeva");
    var mjeseci = document.getElementById("mjeseci");

    for (let i = 0; i < layers.length - 1; i++) {
      map.removeLayer(layers[i]);
      }
      mjeseci.textContent = "";

    slider.addEventListener("input", function() {
      var val = parseInt(this.value);
      for (let i = 0; i < layers.length; i++) {
      if (map.hasLayer(layers[i]) && i !== val) {
      let pane = layers[i].getPane();
      if (pane) pane.style.transition = "opacity 0.6s";
      pane.style.opacity = 0;
      setTimeout(() => {
      map.removeLayer(layers[i]);
      if (pane) pane.style.opacity = 1;
      }, 600);
      }
      }

    map.addLayer(layers[val]);
      let newPane = layers[val].getPane();
      currentLayer = layers[val];
      if (newPane) {
      newPane.style.opacity = 0;
      newPane.style.transition = "opacity 0.6s";
      requestAnimationFrame(() => {
      newPane.style.opacity = 1;
      });
      }

    var labels = [
    "24. lipnja 2021.",
    "27. lipnja 2022.",
    "22. srpnja 2022.",
    "16. srpnja 2023.",
    "26. kolovoza 2023.",
    "11. srpnja 2024.",
    "12. kolovoza 2024.",
    "14. srpnja 2025.",
    "15. kolovoza 2025.",
    "Prosječna ljetna temperatura (2021. - 2025.)"
    ];
    mjeseci.textContent = labels[val];
    applyTempFilter(minVal, maxVal);
    });

    function applyTempFilter(min, max) {
      layers.forEach(function (lyr) {
        if (!lyr._allFeatures) return;            
        if (!map.hasLayer(lyr)) return;           
    var features = lyr._allFeatures.slice(0);
    for (var i = features.length - 1; i >= 0; --i) {
      var t = features[i].properties['Temperatur'];
      if (t < min || t > max) {
      features.splice(i, 1);
      }
      }
    lyr.clearLayers();
    lyr.addData(features);
    });
    }

    var auto = false;
    var button = document.getElementById("autogumb");
    var animFrame;
    var val = 0;

    button.onclick = function() {
      auto = !auto;
      if (auto) {
      this.innerText = "Zaustavi automatsku izmjenu";
      val = 0;
      animate();
      } else {
      this.innerText = "Pokreni automatsku izmjenu";
      cancelAnimationFrame(animFrame);
      slider.value = slider.max;               
      mjeseci.textContent = "";             
      currentLayer = layers[layers.length-1];
      map.addLayer(currentLayer);
      }
      };

    function animate() {
      if (!auto) return;
      slider.value = val;
      slider.dispatchEvent(new Event('input'));
      val++;
      if (val > 9) val = 0;
      animFrame = requestAnimationFrame(() => setTimeout(animate, 1000));
      }

        setBounds();

    map.on('load', function () {
      document.getElementById('tempraspon').style.display = 'block';
      document.getElementById('rasponIcon').style.display = 'flex';
      document.getElementById('temperaturna-legenda').style.display = 'none';
      document.getElementById('tempIcon').style.display = 'flex';
      document.getElementById('koordinatni-okvir').style.display = 'flex';
      });
    map.fire('load');

    const rasponIcon = document.getElementById("rasponIcon");
    const pomakokvir = document.getElementById("pomakokvir");
    rasponIcon.addEventListener("click", () => {
    const icon = rasponIcon.querySelector("i");
    const isHidden = pomakokvir.style.display === "none" || pomakokvir.style.display === "";
    if (isHidden) {
      pomakokvir.style.display = "flex";
      icon.style.color = "red";
    } else {
      pomakokvir.style.display = "none";
      icon.style.color = "#333";
      minVal = 0;
      maxVal = 50;
    updateUI();
    }
    });

    const pomak = document.getElementById("pomak");
    const range = document.getElementById("range");
    const klizacMin = document.getElementById("klizacMin");
    const klizacMax = document.getElementById("klizacMax");
    const valMinSide = document.getElementById("valMinSide");
    const valMaxSide = document.getElementById("valMaxSide");
    let minVal = 0;
    let maxVal = 50;
    let maxRange = 50;

    const colorStops = [
    { value: 0, color: "#2c7bb6" },
    { value: 10, color: "#abd9e9" },
    { value: 20, color: "#ffffbf" },
    { value: 30, color: "#fdae61" },
    { value: 40, color: "#d7191c" },
    { value: 50, color: "#890000" }
    ];

    function updateUI() {
      const percentMin = (minVal / maxRange) * 100;
      const percentMax = (maxVal / maxRange) * 100;
      klizacMin.style.left = percentMin + "%";
      klizacMax.style.left = percentMax + "%";
      range.style.left = percentMin + "%";
      range.style.width = (percentMax - percentMin) + "%";
      const percent = (val) => ((val - minVal) / (maxVal - minVal)) * 100;
      const stops = colorStops
      .filter(c => c.value >= minVal && c.value <= maxVal)
      .map(c => `${c.color} ${percent(c.value)}%`);
      range.style.background = stops.length > 0
      ? `linear-gradient(to right, ${stops.join(", ")})`
      : "#4CAF50";
      valMinSide.textContent = minVal + "°C";
      valMaxSide.textContent = maxVal + "°C";
      applyTempFilter(minVal, maxVal);
      }

    function startDrag(klizac, type) {
      function move(e) {
      e.preventDefault();
      const rect = pomak.getBoundingClientRect();
      let clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;
      let x = clientX - rect.left;
      x = Math.max(0, Math.min(rect.width, x));
      let value = Math.round((x / rect.width) * maxRange);
      if (type === "min") minVal = Math.min(value, maxVal);
      else maxVal = Math.max(value, minVal);
      updateUI();
      }

    function stop() {
      document.removeEventListener("mousemove", move);
      document.removeEventListener("mouseup", stop);
      document.removeEventListener("touchmove", move);
      document.removeEventListener("touchend", stop);
      }

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", stop);
    document.addEventListener("touchmove", move, { passive: false });
    document.addEventListener("touchend", stop);
    }

    klizacMin.addEventListener("mousedown", () => startDrag(klizacMin, "min"));
    klizacMax.addEventListener("mousedown", () => startDrag(klizacMax, "max"));
    klizacMin.addEventListener("touchstart", () => startDrag(klizacMin, "min"));
    klizacMax.addEventListener("touchstart", () => startDrag(klizacMax, "max"));
    updateUI();

    proj4.defs(
    "EPSG:3765",
    "+proj=tmerc +lat_0=0 +lon_0=16.5 +k=0.9999 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs"
    );

    function toDMS(deg) {
      const absolute = Math.abs(deg);
      const degrees = Math.floor(absolute);
      const minutesFloat = (absolute - degrees) * 60;
      const minutes = Math.floor(minutesFloat);
      const seconds = ((minutesFloat - minutes) * 60).toFixed(2);
      const degreesStr = degrees;
      const minutesStr = minutes < 10 ? '0' + minutes : minutes;
      const secondsStr = seconds < 10 ? '0' + seconds : seconds;
      const sign = deg < 0 ? '-' : '';
      return `${sign}${degreesStr}° ${minutesStr}' ${secondsStr}''`;
      }

    const coordsDiv = document.getElementById('koordinate');
    const izborprojekcije = document.getElementById('izbor-projekcije');

    map.on('mousemove', function (e) {
      const lat = e.latlng.lat;
      const lon = e.latlng.lng;
      const selected = izborprojekcije.value;

    if (selected === "wgs84") {
    const latDMS = toDMS(lat);
    const lonDMS = toDMS(lon);
    coordsDiv.textContent = `φ: ${latDMS}, λ: ${lonDMS}`;
    } else if (selected === "htrs96") {
    const [easting, northing] =
    proj4("EPSG:4326", "EPSG:3765", [lon, lat]);
    coordsDiv.textContent =
    `E: ${easting.toFixed(2)} m, N: ${northing.toFixed(2)} m`;
    }
    });
 
    map.setView([45.785, 16], 11);

    </script>        
  </body>
</html>